SELECT 
    DISTINCT 
    T1.TIPO_DOCUMENTO, 
    T1.KEY_ID, 
    T1.CATEGORIA,
    T2.nivel_de_riesgo,
    T2.ocupacion
FROM 
    (
        SELECT DISTINCT 
            TIPO_DOCUMENTO, 
            KEY_ID,
            CASE
                WHEN REGEXP_CONTAINS(UPPER(CARGO), r'(DOCTOR|DOCTORA|ENFERMERO|ENFERMERA|SALUD)') THEN 'SALUD'
                WHEN REGEXP_CONTAINS(UPPER(CARGO), r'(INGENIERO|INGENIERA|ARQUITECTO|TÉCNICO)') THEN 'INGENIERIA'
                WHEN REGEXP_CONTAINS(UPPER(CARGO), r'(TECNICO|AUXILIAR)') THEN 'TECNICO'
                WHEN REGEXP_CONTAINS(UPPER(CARGO), r'(PSICOLOGO|PSICOLOGA|TRABAJO SOCIAL|TRABAJADORA SOCIAL)') THEN 'HUMANIDADES'
                WHEN REGEXP_CONTAINS(UPPER(CARGO), r'(ARTISTA|MÚSICO|DISEÑADOR|PINTOR)') THEN 'ARTES'
                WHEN REGEXP_CONTAINS(UPPER(CARGO), r'(AGRONOMO|AGRONOMA|VETERINARIO|VETERINARIA)') THEN 'AGROPECUARIO'
                WHEN REGEXP_CONTAINS(UPPER(CARGO), r'(ABOGADO|ABOGADA|CONTADOR|CONTADORA|LEGAL)') THEN 'LEGAL-CONTABLE'
                WHEN REGEXP_CONTAINS(UPPER(CARGO), r'(OTROS)') THEN 'OTROS'
                WHEN REGEXP_CONTAINS(UPPER(CARGO), r'(ADMINISTRADOR|ADMINISTRADORA|GERENTE|COORDINADOR)') THEN 'ADMINISTRADOR'
                WHEN REGEXP_CONTAINS(UPPER(CARGO), r'(PROFESOR|MAESTRO|EDUCADOR|DOCENTE|TUTOR)') THEN 'EDUCACION'
                WHEN REGEXP_CONTAINS(UPPER(CARGO), r'(CIENTÍFICO|CIENTIFICA|INVESTIGADOR|INVESTIGADORA)') THEN 'CIENCIAS'
                WHEN REGEXP_CONTAINS(UPPER(CARGO), r'(POLICÍA|MILITAR|SEGURIDAD|DEFENSA)') THEN 'SEGURIDAD-DEFENSA'
                WHEN REGEXP_CONTAINS(UPPER(CARGO), r'(BANCA|)') THEN 'BANCA'
                ELSE 'Otro'
            END AS CATEGORIA
        FROM `sb-ecosistemaanalitico-lago.seguros_bolivar.t_clientes_naturales`
    ) AS T1
JOIN 
    `sb-sandbox-usuarios.sandbox_cumplimiento.t_ocupacion_nivel_riesgo` AS T2
ON 
    T1.CATEGORIA = T2.ocupacion;
