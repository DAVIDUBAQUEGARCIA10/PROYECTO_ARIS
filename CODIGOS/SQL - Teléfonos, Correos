select DISTINCT j.numero_documento            numero_documento_juridico
      ,j.tipdoc_codigo               tipo_documento_juridico
      ,j.razon_social                razon_social_juridico
      --,mcj.tipmedcom_codigo          cod_medio_comunica_jur
      ,mcj.descripcion               desc_medio_comunica_jur
      --,tmcj.descripcion              desc_tipo_medio_comunica_jur       
      ,n.numero_documento            numero_documento_rep
      ,j.tipdoc_codigo               tipo_documento_rep
      ,n.primer_nombre||' '||
       n.segundo_nombre||' '||
       n.primer_apellido||
       n.segundo_apellido            Nombres_Rep
      ---,mcn.tipmedcom_codigo          cod_medio_comunica_rep
      ,mcn.descripcion               desc_medio_comunica_rep
      --,tmcn.descripcion               desc_tipo_medio_comunica_rep
from   juridicos j
      ,naturales n
      ,medios_comunicacion mcn
      ,tipos_medios_comunicacion tmcn
      ,medios_comunicacion mcj
      ,tipos_medios_comunicacion tmcj
where n.numero_documento = j.numero_documento_representante
  and  n.tipdoc_codigo    = j.tipdoc_codigo_identificado_por
  and  mcn.nat_secuencia  = n.secuencia
  and  tmcn.secuencia     = mcn.tipmedcom_codigo
  and  mcj.jur_secuencia  = j.secuencia
  and  tmcj.secuencia     = mcj.tipmedcom_codigo
  and (tmcn.descripcion like '%EMAIL%' OR tmcj.descripcion like '%EMAIL%')
  and  j.numero_documento = 901169698



-------CORREO AMBAS BASES EN UNION 

SELECT DISTINCT
    j.numero_documento                  AS numero_documento,
    j.tipdoc_codigo                     AS tipo_documento,
    j.razon_social                      AS razon_social,
        
    -- Columna única que muestra solo el correo electrónico
    CASE 
        WHEN mcj.descripcion LIKE '%@%' THEN mcj.descripcion
        WHEN mcn.descripcion LIKE '%@%' THEN mcn.descripcion
        ELSE NULL
    END AS correo_unificado

FROM juridicos j
JOIN naturales n ON n.numero_documento = j.numero_documento_representante
                AND n.tipdoc_codigo = j.tipdoc_codigo_identificado_por
JOIN medios_comunicacion mcn ON mcn.nat_secuencia = n.secuencia
JOIN tipos_medios_comunicacion tmcn ON tmcn.secuencia = mcn.tipmedcom_codigo
JOIN medios_comunicacion mcj ON mcj.jur_secuencia = j.secuencia
JOIN tipos_medios_comunicacion tmcj ON tmcj.secuencia = mcj.tipmedcom_codigo
WHERE j.numero_documento = 901169698
  AND (tmcn.descripcion LIKE '%EMAIL%' OR tmcj.descripcion LIKE '%EMAIL%')


UNION ALL 

SELECT DISTINCT
    n.numero_documento                      AS numero_documento,
    n.tipdoc_codigo                         AS tipo_documento,
    
    -- Concatenación del nombre completo
    n.primer_nombre || ' ' || 
    n.segundo_nombre || ' ' || 
    n.primer_apellido || 
    n.segundo_apellido                     AS nombres,
    
    -- Correo unificado (solo EMAILs válidos)
    CASE 
        WHEN mcn.descripcion LIKE '%@%' THEN mcn.descripcion
        ELSE NULL
    END AS correo_unificado

FROM naturales n
JOIN medios_comunicacion mcn ON mcn.nat_secuencia = n.secuencia
JOIN tipos_medios_comunicacion tmcn ON tmcn.secuencia = mcn.tipmedcom_codigo
WHERE tmcn.descripcion LIKE '%EMAIL%'
and  n.numero_documento  = '1000796179'



----TELEFONO AMBAS BASES 

SELECT DISTINCT 
  j.numero_documento            AS numero_documento_juridico,
  j.tipdoc_codigo               AS tipo_documento_juridico,  
  -- Celular unificado con prioridad: representante > jurídico
  CASE
    WHEN REGEXP_LIKE(TRIM(mcn.descripcion), '^[0-9]{10}$') THEN mcn.descripcion
    WHEN REGEXP_LIKE(TRIM(mcj.descripcion), '^[0-9]{10}$') THEN mcj.descripcion
    ELSE NULL
  END AS celular_unificado

FROM juridicos j
JOIN naturales n
  ON n.numero_documento = j.numero_documento_representante
 AND n.tipdoc_codigo = j.tipdoc_codigo_identificado_por
JOIN medios_comunicacion mcn
  ON mcn.nat_secuencia = n.secuencia
JOIN tipos_medios_comunicacion tmcn
  ON tmcn.secuencia = mcn.tipmedcom_codigo
JOIN medios_comunicacion mcj
  ON mcj.jur_secuencia = j.secuencia
JOIN tipos_medios_comunicacion tmcj
  ON tmcj.secuencia = mcj.tipmedcom_codigo

WHERE (tmcn.descripcion LIKE '%CELULAR%' OR tmcj.descripcion LIKE '%CELULAR%')
  AND j.numero_documento = 901169698
  
  UNION ALL 
  

SELECT DISTINCT
    n.numero_documento                      AS numero_documento,
    n.tipdoc_codigo                         AS tipo_documento,
        
    -- Correo unificado (solo EMAILs válidos)
    CASE 
        WHEN mcn.descripcion NOT LIKE '%@%' THEN mcn.descripcion
        ELSE NULL
    END AS correo_unificado
FROM naturales n
JOIN medios_comunicacion mcn ON mcn.nat_secuencia = n.secuencia
JOIN tipos_medios_comunicacion tmcn ON tmcn.secuencia = mcn.tipmedcom_codigo
WHERE n.numero_documento  = '1014282242' AND
mcn.descripcion NOT LIKE '%@%'  
  

