SELECT 
    TBEN.COD_BENEF,
    TIP.TIPDOC_CODIGO as TDOC_TERCERO,
    TO_CHAR(TRUNC(T3.FECHA), 'DD/MM/YYYY') AS FECHA_TRANSACCION,
    801 AS COD_SECC,
    T2.PLAN_CODIGO as COD_RAMO,
    T3.TITU_NRO_TITULO as NUMERO_PRODUCTO,
    (SELECT DESC_FORM_PAGO FROM A1002500 WHERE COD_PAGO = T2.TIPREC_COD_PAGO) AS FORMA_PAGO_COBRO,
    T3.VALOR AS VALOR_TRANSACCION,
    T1.NOMBRE AS NOMBRE_TIPO_MOV,
    T2.OFIC_VENTA AS COD_AGENCIA,
    '' AS CPOS_AGENCIA,
    1 AS COD_CIA
FROM T3110000 T3
JOIN T2020105 T2 ON T3.TITU_COMP_COD_CIA = T2.COMP_COD_CIA 
                 AND T3.TITU_NRO_TITULO = T2.NRO_TITULO 
                 AND T3.TITU_DIGITO_CONTROL = T2.DIGITO_CONTROL
JOIN T1012010 T1 ON T3.TIPMOV_CODIGO = T1.CODIGO
JOIN T2020100 TBEN ON T2.COMP_COD_CIA = TBEN.COMP_COD_CIA 
                   AND T2.NRO_TITULO = TBEN.TITU_NRO_TITULO 
                   AND T2.DIGITO_CONTROL = TBEN.TITU_DIGITO_CONTROL
LEFT JOIN (SELECT NUMERO_DOCUMENTO, TIPDOC_CODIGO
            FROM JURIDICOS
            UNION ALL
            SELECT NUMERO_DOCUMENTO, TIPDOC_CODIGO
            FROM NATURALES) TIP ON TIP.NUMERO_DOCUMENTO = TBEN.COD_BENEF 

WHERE TRUNC(T3.FECHA) >= TO_DATE('20231101', 'YYYYMMDD')
    AND TRUNC(T3.FECHA) < TO_DATE('20241130', 'YYYYMMDD');
