SELECT
  t1.FECHA_TRANSACCION,
  t1.TIPO_DOCUMENTO,
  t1.KEY_ID,
  t1.NUMERO_TITULO,
  t1.FORMA_PAGO,
  t1.VALOR_TRANSACCION,
  t1.PLAN_CODIGO,
  t1.NOMBRE_DESCRIPCION_TITULO,
  t1.OFICINA,
  t2.CODIGO_RESTRICCION,
  t2.DESCRIPCION,
  t2.FECHA_CREACION,
  t2.FECHA_MODIFICACION
FROM
  `sb-ecosistemaanalitico-lago.capitalizadora.t_transacciones_enriquecida` AS t1
LEFT JOIN
  `sb-ecosistemaanalitico-lago.seguros_bolivar.t_terceros_restringidos` AS t2
  ON t1.TIPO_DOCUMENTO = t2.TIPO_DOCUMENTO_TERCERO
  AND t1.KEY_ID = t2.KEY_ID
WHERE
  t1.FECHA_TRANSACCION >= '2024-01-01'
  AND t1.NOMBRE_DESCRIPCION_TITULO IN (
    'REC.CTAS POST TRANSF DAVIV',
    'REC.CUOT.POST.CJAS DAVIVIENDA',
    'REC.CUOT.POST.CJAS.BOLIVAR',
    'REC.CUOT.INIC.TRANSF.DAVIV',
    'REC.CUOT.INIC.CJAS.BOLIVAR',
    'REC.CUOT.INIC.DEB.CONVENIOS',
    'RECAUDO BOTON DE PAGOS',
    'PAGO RESC.CUOT.POST SIN CUPON',
    'REC.CUOT.INIC.DEB.CORPORATIVO',
    'PAGO SALDO FAVOR CLIENTE',
    'PAGO RESC.CUOT.ADELANTADAS NORMAL',
    'PAGO RESC.INT.CUOT.ADELANTADAS',
    'CORREC. INCONS. CUOTA POSTER.',
    'REC.REINTE.UNID CJAS.DAVIVIENDA',
    'REC.CUOT.INIC.DATAFONOS',
    'RECAUDO CUOTAS TELEFONO ROJO',
    'REC. CUOTAS POSTERIORES GANALEASING',
    'REC. CUOTAS INICIALES GANALEASING',
    'REC INICIALES ESTRAORD'
  )
  AND t1.VALOR_TRANSACCION >= 1000000
  AND t2.CODIGO_RESTRICCION = 23;
