SELECT 
    a.CODIGO_COMPANIA,
    a.CODIGO_RAMO_EMISION,
    a.NOMBRE_RAMO_EMISION,
    a.CODIGO_PRODUCTO,
    a.NOMBRE_PRODUCTO,
    a.CODIGO_LOCALIDAD,
    a.CLAVE_AGENTE,
    a.NUMERO_POLIZA,
    a.NUMERO_POLIZA_ANTERIOR,
    a.FECHA_EMISION_POLIZA,
    a.FECHA_VIGENCIA_POLIZA,
    a.FECHA_VENCIMIENTO_POLIZA,
    a.FECHA_CANCELACION_POLIZA,
    a.FECHA_VIGENCIA_ENDOSO,
    a.FECHA_VENCIMIENTO_ENDOSO,
    a.ESTADO_NEGOCIO,
    a.FORMA_COBRO,
    a.CANAL_DESCUENTO,
    a.TIPO_DOCUMENTO_TOMADOR,
    a.NUMERO_DOCUMENTO_TOMADOR,
    a.NOMBRE_TOMADOR,
    a.CODIGO_ACTIVIDAD_ECONOMICA_TOMADOR,
    a.FECHA_RECAUDO,
    a.VALOR_RECAUDO_MES,
    a.FECHA_CARGUE,
    c.CODIGO_RESTRICCION,
    c.DESCRIPCION,

FROM 
    `sb-ecosistemaanalitico-lago.datamart.t_produccion_recaudo_diario` a
LEFT JOIN 
    `sb-sandbox-usuarios.sandbox_cumplimiento.t_terceros_clientes` b
ON 
    a.TIPO_DOCUMENTO_TOMADOR = b.TIPO_DOCUMENTO
    AND a.NUMERO_DOCUMENTO_TOMADOR = b.NUMERO_DOCUMENTO
LEFT JOIN
    `sb-ecosistemaanalitico-lago.seguros_bolivar.t_terceros_restringidos` c
ON 
    b.TIPO_DOCUMENTO = c.TIPO_DOCUMENTO_TERCERO
    AND b.KEY_ID = c.KEY_ID
WHERE 
    a.VALOR_RECAUDO_MES > 1280951       
    AND a.FECHA_VIGENCIA_POLIZA >= "2024-01-01"
    AND a.FECHA_RECAUDO >= "2024-01-01"        
    AND a.CODIGO_RAMO_EMISION IN (46,47,48,49)
    AND a.FORMA_COBRO != "CONVENIO"
    AND a.TIPO_REGISTRO = 'RECAUDO'
    and c.CODIGO_RESTRICCION = 23
